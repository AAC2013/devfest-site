{% extends "global.html" %}

{% block head2 %}
<script type="text/javascript">
$(document).ready(function() {
  $('#add_speaker').click(function() {
    clone_field_list('#speakers li:last');
  });
  handle_delete_buttons('#speakers');
  $('#speakers').children('lixxx').each(function() {
    var label = $(this).children('label')[0];
    var id = label.for;
    label.innerHTML = label.innerHTML + " <input type='button' " +
             " onclick='delSpeaker(\"" + id + "\");' value='delete speaker'>";
  });
});

function handle_delete_buttons(selector) {
  if ($(selector).children('li').length < 2) {
    // remove delete button
    $(selector).children('li').each(function() {
      $(this).children('label')[0].innerHTML = "";
    });
  }
  else {
    // add delete buttons
    $(selector).children('li').each(function() {
      var label = $(this).children('label')[0];
      var id = $(this).children('table').attr('id');
      label.innerHTML = "<input type='button' onclick='del_speaker(\"" +
            id + "\");' value='delete' />";
    });
  }
}

function del_speaker(id) {
  $('#' + id).parent().remove();
  handle_delete_buttons('#speakers');
}

function clone_field_list(selector) {
  var new_element = $(selector).clone(true);
  var elem_id = new_element.find('input')[0].id;
  var elem_num = parseInt(elem_id.replace(/.*-(\d{1,4})-.*/m, '$1')) + 1;
  new_element.find(':input').each(function() {
    var id = $(this).attr('id').replace('-' + (elem_num - 1) + '-', '-' + elem_num + '-');
    $(this).attr({'name': id, 'id': id}).val('').removeAttr('checked');
  });
  new_element.find('label').each(function() {
    var new_for = $(this).attr('for').replace('-' + (elem_num - 1) + '-', '-' + elem_num + '-');
    $(this).attr('for', new_for);
  });
  new_element.children('label')[0].innerHTML = "New Speaker";
  $(selector).after(new_element);
  handle_delete_buttons('#speakers');
}
</script>
{% endblock %}

{% block document_ready %}

{% endblock %}


{% macro with_errors(field) %}
<div class="form_field">
  {{ field.label }}
  {% if field.description %}
  <div><small>{{ field.description }}</small></div>
  {% endif %}
   {% if field.errors %}
    {% set css_class = 'has_error ' + kwargs.pop('class', '') %}
    {{ field(class=css_class, **kwargs) }}
    <div class="error">
    <ul class="alert alert-error">{% for error in field.errors %}<li>{{ error|e }}</li>{% endfor %}</ul>
        </div>
  {% else %}
    {{ field(**kwargs) }}
  {% endif %}
  </div>
{% endmacro %}

{% block content %}

<div class="container-fluid">

	<div class="row">
		<div id="title">
			<h1 style="font-size: 25px; float: none; margin-bottom: 10px">Add your event speakers!</h1>
		</div>
		<hr class="thin-line">
	</div>
	
	   <div class="row-fluid">
			<div class="span3">
				<div class="row">
					<span style="margin-left: 5px"> <img src="/images/gdgbig.png">
		
					</span>
				</div>
			</div>
	
			<div class="span9">
						<div class="row">
						<div id="gdg-create-event">
							
              <form method="post" class="form-horizontal" enctype="multipart/form-data" action="{{ form_url }}">
                  {% if event %}<input type="hidden" name="event" value="{{ event }}">{% endif %}
												{% if updated_successful %}
												<div class="alert alert-success">Speaker list edited successfully ! </div>
												{% endif %}
												<br>
												<h3>Details</h3>
												<hr>												
												  {{ with_errors(form.speakers) }}
                  <input type="button" id="add_speaker" value="add speaker">
												<br><br>
												  <div>
												    <input type="submit" value="save" />
												  </div>
												</form>
										
											
											
											
							</div>
					</div>
			</div>
		</div>	
	</div>
{% endblock %}
